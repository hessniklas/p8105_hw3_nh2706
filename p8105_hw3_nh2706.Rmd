---
title: "HW3"
author: "Niklas Hess"
date: "10/17/2022"
output: github_document
---

```{r setup, message = FALSE, warning = FALSE}
library(tidyverse)
library(p8105.datasets)
library(ggridges)
library(patchwork)
knitr::opts_chunk$set(echo = TRUE) 
knitr::opts_chunk$set(
  fig.width = 12,
  fig.asp = .6,
  out.width = "95%")
```

# Problem 1
Omitted, as solutions are provided by Professor. 

# Problem 2

#### First, I am loading and cleaning the data ahead of the next problems
```{r load_data_accel, message = FALSE, warning = FALSE}
accel_df = read_csv("Data/accel_data.csv") %>%
  janitor::clean_names() %>%
  mutate(weekend = ifelse((day == "Saturday" | day == "Sunday"),"Weekend","Weekday"),
         day = as.factor(day),
         weekend = as.factor(weekend))  %>%
  relocate(week,day_id, day,weekend)
```

#### Second, I am calculating the activity totals and then dropping the individuals activity variables
```{r activity_totals, message = FALSE, warning = FALSE}
aggregate_accel_df = accel_df %>%
  mutate(total_activity = rowSums(accel_df[,c(5:1444)])) %>%
  group_by(day_id) %>%
  relocate(week,day_id, day,weekend,total_activity) %>%
  select(1:5)

knitr::kable(aggregate_accel_df)
```

#### Third, I am showing the day activity to identify any interesting trends throughout the study period.
```{r plot_1_accel, message = FALSE, warning = FALSE}
ggplot(aggregate_accel_df,aes(x = day_id, y = total_activity, color = weekend)) +
  geom_point() +
  geom_line() +
  labs(
    title = "Total Activity per day (for study period by week(end/day))",
    x = "Day ID",
    y = "Total Activity",
    caption = "Visual Depiction of accel_data.csv for daily trends"
    ) +
  scale_x_continuous(breaks = seq(0,35,by = 5)) +
  theme(plot.title = element_text(hjust = 0.5))
```

#### Fourth, I am converting the data to long-format, to be able to plot minutes by days
```{r accel_long, message = FALSE, warning = FALSE}
accel_longer_df = accel_df %>%
  pivot_longer(
    cols = activity_1:activity_1440,
    names_to = "minute",
    values_to = "activity",
    names_prefix = "activity_"
    ) %>% 
  mutate(minute = as.numeric(minute))
```

#### Firth (and last), I am plotting the long format of minutes and activity by day to show any daily trends throughout the week.
```{r plot_2_accel, message = FALSE, warning = FALSE}
accel_longer_df %>%
  ggplot(aes(x = minute, y = activity, color = day)) +
  geom_point() +
  geom_line(alpha = .3) +
  scale_x_continuous(breaks = seq(0,1440,by = 60),
                     label = seq(0,24,by = 1),
                     limits = c(0,1440)) +
  labs(
    title = "24-hour Activity Time Courses for each Day",
    x = "Minutes (Hours shown)",
    y = "Activity",
    caption = "Visual Depiction of accel_data.csv for trends"
    )
```



# Problem 3

#### First, I load the data from the p8105.datasets
```{r load_data_nynoaa, message = FALSE, warning = FALSE}
data("ny_noaa")
```

#### Second, I describe the Data
The data shows `r ncol(ny_noaa)` variables (`r names(ny_noaa)`) from New York state weather stations from January 1, 1981 through December 31, 2010. It has `r nrow(ny_noaa)` obersvations. Key variables include `r names(ny_noaa)[1]`, which denotes the weather station ID, and `r names(ny_noaa)[2]`, which indicates the date of each subsequent observation. Since each weather station might not collect all variables, missing data is a major issue in the context of this data.

#### Third, I am cleaning the data ahead of the next problems
```{r clean_data, message = FALSE, warning = FALSE}
clean_noaa_df = ny_noaa %>%
  janitor::clean_names() %>%
  separate(date, into = c("year", "month", "day"), sep = '-') %>%
  mutate(month = as.numeric(month),
         year = as.numeric(year),
         month = factor(month.abb[month], levels = month.abb),
         tmax = as.numeric(tmax)/10,
         tmin = as.numeric(tmin)/10,
         prcp = as.numeric(prcp)/10)
```

#### Fourth, I calculate the Mode for Snow and describe the rationale in more detail
```{r, message = FALSE, warning = FALSE}
find_mode <- function(a) {
  value <- unique(a)
  tab <- tabulate(match(a, value))
  value[tab == max(tab)]
}
```

The most commonly observed values for snowfall are `r find_mode(clean_noaa_df$snow)`, which makes sense because most of the year there is no snow-fall.

#### Fifth, I graph a two-panel plot showing the average max temperature in January and in July in each station across years
```{r, message = FALSE, warning = FALSE}
mean_max_temp = clean_noaa_df %>%
  filter(month == "Jan" | month == "Jul") %>%  
  group_by(id, year, month) %>% 
  summarize(mean_temperature = mean(tmax, na.rm = TRUE)) %>%
  ggplot(aes(x = year, y = mean_temperature, group = id)) +
  geom_line() +
  facet_grid(. ~ month) +
  labs(
    title = "Max temperature in January and in July in each station across years",
    x = "Years among weather stations",
    y = "Mean_Max_temperature",
    caption = "Data from ny_noaa") +
  theme(legend.position = "none")

mean_max_temp
```

Is there any observable / interpretable structure? Any outliers?

#### Sixth, I graph a two-panel plot showing tmax vs tmin for the full dataset 

```{r, message = FALSE, warning = FALSE}
maxmin_plot = clean_noaa_df %>%
  ggplot(aes(x = tmax, y = tmin)) +
  geom_hex() +
  labs(title = "Max vs Min Temp over years",
       x = "Max Temp (C)",
       y = "Min Temp (C)",
       caption = "Data from NY NOAA.") +
  theme(legend.position = "left")

snowfall_plot = clean_noaa_df %>%
  filter(snow > 0, snow < 100) %>%
  ggplot(aes(x = snow, y = as.factor(year))) +
  geom_density_ridges(scale = 1) +
  xlim(0, 100) +
  labs(title = "Snowfall Distribution by Year (0-100 mm)",
       x = "Snowfall",
       y = "Year",
       caption = "Data from NY NOAA.")

maxmin_plot + snowfall_plot
```